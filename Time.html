<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å­¸æ¸¬ï¼å¿—é¡˜ å€’æ•¸ï½œåŠ å…¥è¡Œäº‹æ›†</title>
<style>
  :root{
    --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#22d3ee; --accent2:#a78bfa;
    --ok:#34d399; --warn:#fbbf24; --highlight:#ffd166; --link:#93c5fd; --chip:#4b5563;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","PingFang TC","Microsoft JhengHei","Apple Color Emoji",sans-serif; background: radial-gradient(1000px 600px at 20% -10%,#1f2937,transparent), var(--bg); color:var(--text)}
  a{color:var(--link); text-decoration:none}
  a:hover{text-decoration:underline}
  header{padding:28px 20px 16px; text-align:center}
  h1{margin:0 0 8px; font-size:clamp(22px,3vw,30px)}
  .tz{color:var(--muted); font-size:14px}
  .container{max-width:1100px; margin:0 auto; padding:0 16px 36px}
  .grid{display:grid; gap:16px}
  .grid-3{grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); margin:14px 0 24px}
  .grid-2{grid-template-columns: repeat(auto-fit,minmax(320px,1fr));}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.06); border-radius:14px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,0.35)}
  .section-title{font-size:18px; font-weight:800; letter-spacing:.3px; margin:6px 0 8px}
  .quote{font-size:16px; line-height:1.6}
  .joke{font-size:15px; line-height:1.6}
  .trend-title{font-weight:700; font-size:16px; margin:6px 0}
  .trend-meta{color:var(--muted); font-size:13px; margin-top:4px}
  .chip{display:inline-block; background:var(--chip); color:#e5e7eb; border-radius:999px; padding:2px 8px; font-size:12px; margin-left:6px}
  .title{display:flex; align-items:center; justify-content:space-between; gap:8px}
  .badge{font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.12); color:var(--muted)}
  .event-name{font-weight:800; font-size:clamp(24px,5vw,32px); color:var(--highlight); letter-spacing:0.5px}
  .big{font-weight:700; font-size:clamp(28px,5vw,40px); letter-spacing:0.5px; margin:8px 0}
  .detail{color:var(--muted); font-size:14px; margin-top:2px}
  .row{margin-top:14px; display:flex; gap:10px; flex-wrap:wrap}
  .btn{flex:1 1 200px; text-align:center; border:1px solid rgba(255,255,255,0.14); padding:12px 14px; border-radius:10px; cursor:pointer; user-select:none; text-decoration:none; color:var(--text); transition:transform .05s ease; font-weight:600}
  .btn:hover{transform:translateY(-1px)}
  .btn-primary{border-color:transparent; background:linear-gradient(90deg,var(--accent),var(--accent2))}
  .btn-ghost{background:rgba(255,255,255,0.03)}
  .meta{display:flex; align-items:center; gap:10px; margin-top:10px; color:var(--muted); font-size:13px}
  .dot{width:8px; height:8px; border-radius:50%}
  .ok{background:var(--ok)} .warn{background:var(--warn)}
  footer{max-width:1100px; margin:0 auto; padding:8px 16px 28px; color:var(--muted); font-size:13px}
</style>
</head>
<body>
  <header>
    <h1>å­¸æ¸¬ï¼å¿—é¡˜ å€’æ•¸ï½œä¸€éµåŠ å…¥è¡Œäº‹æ›†ï¼ˆGoogleï¼Outlookï¼‰</h1>
    <div class="tz">ä½ çš„æ™‚å€ï¼š<span id="tz"></span>ï¼ˆæ¡ã€Œæ•´å¤©æ´»å‹•ã€é¿å…æ™‚å€èª¤å·®ï¼‰</div>
  </header>

  <div class="container">
    <!-- Top board: Quote / Joke / Trend -->
    <section class="grid grid-3" id="top-board">
      <div class="card">
        <div class="section-title">ä»Šå¤©çš„æ ¼è¨€</div>
        <div class="quote" id="quote">è¼‰å…¥ä¸­â€¦</div>
      </div>
      <div class="card">
        <div class="section-title">æ”¾é¬†ä¸€ä¸‹</div>
        <div class="joke" id="joke">è¼‰å…¥ä¸­â€¦</div>
      </div>
      <div class="card">
        <div class="section-title">æ™‚å‹¢é€Ÿè®€ï¼ˆ104 å‡ºå“ï¼‰<span id="trend-chip" class="chip" style="display:none">å½±ç‰‡å„ªå…ˆ</span></div>
        <div class="trend-title"><a id="trend-link" target="_blank" rel="noopener">è¼‰å…¥ä¸­â€¦</a></div>
        <div class="trend-meta" id="trend-meta"></div>
        <div><a href="https://blog.104.com.tw/" target="_blank" rel="noopener">æ›´å¤š 104 å…§å®¹</a></div>
      </div>
    </section>

    <!-- Countdown + calendar -->
    <section class="grid grid-2" id="cards"></section>
  </div>

  <footer>
    æç¤ºï¼šGoogle æœƒé–‹å•Ÿæ–°å¢é é¢è«‹æŒ‰ã€Œå„²å­˜ã€ï¼›Outlookï¼ˆwebï¼‰æœƒé–‹å•Ÿç·¨è¼¯é é¢ï¼Œç¢ºèªå¾Œå„²å­˜å³å¯ã€‚
  </footer>

<script>
(function(){
  // ====== Events (single declaration) ======
  const events = [
    { id:'A', name:'å­¸æ¸¬è€ƒè©¦', date:'2025-12-31', description:'å­¸æ¸¬è€ƒè©¦ï¼ˆæ•´å¤©ï¼‰' },
    { id:'B', name:'ç¹³äº¤å¿—é¡˜', date:'2026-01-31', description:'ç¹³äº¤å¿—é¡˜ï¼ˆæ•´å¤©ï¼‰' },
  ];

  // ====== Quotes & Jokes ======
  const quotes = [
    'æŠŠæ™‚é–“æ”¾åœ¨èƒ½æ”¹è®Šçµæœçš„äº‹ä¸Šï¼Œå…¶é¤˜çš„ï¼Œæ”¾éè‡ªå·±ã€‚',
    'ä»Šå¤©å¤šåšä¸€é¡Œï¼Œæ˜å¤©å¤šä¸€åˆ†æŠŠæ¡ã€‚',
    'æ…¢ä¹Ÿæ²’é—œä¿‚ï¼Œé—œéµæ˜¯ä¸€ç›´å‘å‰ã€‚',
    'ç©©ä½æƒ…ç·’ï¼Œæ¯”é¡Œç›®æ›´é‡è¦ã€‚',
    'ä½ ä¸æ˜¯ä¸€å€‹äººåœ¨èµ°ï¼Œæ‰€æœ‰åŠªåŠ›éƒ½åœ¨å †ç©ã€‚',
    'ä¸è¦å’Œåˆ¥äººçš„é€²åº¦æ¯”è¼ƒï¼Œåªå’Œæ˜¨å¤©çš„è‡ªå·±æ¯”è¼ƒã€‚',
    'æœƒçš„é¡Œè¦é›¶å¤±èª¤ï¼Œä¸æœƒçš„é¡Œè¦æ•¢æ”¾æ‰‹ã€‚',
  ];
  const jokes = [
    'åŒå­¸å•ï¼šè®€æ›¸æœ€æ€•ä»€éº¼ï¼Ÿæˆ‘èªªï¼šæ€•ã€Œé¸æ“‡é¡Œã€â€”å› ç‚ºå®ƒè®“æˆ‘æ‡·ç–‘äººç”Ÿçš„æ¯å€‹é¸æ“‡ã€‚',
    'è€ƒå‰è·Ÿå¯æ¨‚èªªï¼šå¹«æˆ‘åŠ æ²¹ã€‚å¯æ¨‚ï¼šå·²ç¶“åŠ äº†ï¼Œé‚„è¦å¹¾åˆ†ç³–ï¼Ÿ',
    'æˆ‘æœ€æ“…é•·çš„ç§‘ç›®ï¼Ÿè¨ˆæ™‚ã€‚å› ç‚ºæ¯æ¬¡è€ƒè©¦éƒ½åœ¨çœ‹æ™‚é–“ã€‚',
    'è€å¸«èªªè¦ã€Œèæœƒè²«é€šã€ï¼Œæˆ‘å…ˆå¾è²«é€šè¢«çª©é–‹å§‹ã€‚',
    'æ•¸å­¸é¡Œç›®ï¼šè«‹è­‰æ˜ä½ æœƒå¯«ã€‚â€”æˆ‘ï¼šæˆ‘è­‰æ˜ä¸äº†ï¼Œä½†æˆ‘æœƒå¯«åå­—ã€‚',
    'è€ƒè©¦å°±åƒè·‘é¦¬æ‹‰æ¾ï¼Œå·®åˆ¥æ˜¯é¦¬æ‹‰æ¾èƒ½é‚Šè·‘é‚Šå–æ°´ï¼Œè€ƒè©¦åªèƒ½åå£æ°´ã€‚',
    'èƒŒå–®å­—åƒäº¤æœ‹å‹ï¼šæ¯å¤©å¤šèªè­˜å¹¾å€‹ï¼Œä¹…äº†å°±ç†Ÿäº†ã€‚',
  ];

  // ====== Utils ======
  const toLocalDate00 = (ymd) => {
    const [y,m,d] = ymd.split('-').map(Number);
    return new Date(y, m-1, d, 0, 0, 0, 0);
  };
  const yyyymmdd = (dateObj) => {
    const y = dateObj.getFullYear();
    const m = String(dateObj.getMonth()+1).padStart(2,'0');
    const d = String(dateObj.getDate()).padStart(2,'0');
    return `${y}${m}${d}`;
  };
  const addDaysLocal = (dateObj, days) => {
    const d = new Date(dateObj);
    d.setDate(d.getDate() + days);
    return d;
  };
  function diffPartsTo(target){
    const now = new Date();
    let diff = target - now;
    if (diff < 0) diff = 0;
    const sec = Math.floor(diff/1000);
    const days = Math.floor(sec / 86400);
    const hours = Math.floor((sec % 86400) / 3600);
    const mins = Math.floor((sec % 3600) / 60);
    const secs = sec % 60;
    return {days, hours, mins, secs};
  }
  function daysLeft(target){
    const today00 = new Date(); today00.setHours(0,0,0,0);
    const ms = target - today00;
    const d = Math.ceil(ms / 86400000);
    return Math.max(d, 0);
  }
  function googleUrl(evt){
    const start = toLocalDate00(evt.date);
    const end = addDaysLocal(start, 1);
    const base = 'https://calendar.google.com/calendar/render?action=TEMPLATE';
    const text = encodeURIComponent(evt.name);
    const dates = `${yyyymmdd(start)}/${yyyymmdd(end)}`;
    const details = encodeURIComponent(evt.description || '');
    return `${base}&text=${text}&dates=${dates}&details=${details}`;
  }
  function outlookWebUrl(evt){
    const start = toLocalDate00(evt.date);
    const end = addDaysLocal(start, 1);
    const base = 'https://outlook.live.com/calendar/0/deeplink/compose';
    const subject = encodeURIComponent(evt.name);
    const body = encodeURIComponent(evt.description || '');
    return `${base}?subject=${subject}&body=${body}&startdt=${start.getFullYear()}-${String(start.getMonth()+1).padStart(2,'0')}-${String(start.getDate()).padStart(2,'0')}&enddt=${end.getFullYear()}-${String(end.getMonth()+1).padStart(2,'0')}-${String(end.getDate()).padStart(2,'0')}&allday=true`;
  }

  // ====== Render Top Board ======
  function selectDaily(list){
    const today = new Date();
    const seed = today.getFullYear()*10000 + (today.getMonth()+1)*100 + today.getDate();
    return list[seed % list.length];
  }
  function renderTopBoard(){
    document.getElementById('quote').textContent = 'ğŸ’¡ ' + selectDaily(quotes);
    document.getElementById('joke').textContent  = 'ğŸ˜„ ' + selectDaily(jokes);
  }

  // å½±ç‰‡å„ªå…ˆï¼šæ‹‰ä¸€æ‰¹æ–‡ï¼ˆé¡åˆ¥ seniorhigh æˆ–é—œéµå­—ï¼‰ï¼ŒæŒ‘å‡ºå« YouTube/å½±ç‰‡è€…ï¼›è‹¥ç„¡å†ç”¨æœ€æ–°ä¸€èˆ¬æ–‡
  async function fetch104Content(){
    const linkEl = document.getElementById('trend-link');
    const metaEl = document.getElementById('trend-meta');
    const chipEl = document.getElementById('trend-chip');

    try{
      // å…ˆå–åˆ†é¡ id
      let catId = null;
      try{
        const catResp = await fetch('https://blog.104.com.tw/wp-json/wp/v2/categories?slug=seniorhigh');
        if(catResp.ok){
          const cats = await catResp.json();
          if(Array.isArray(cats) && cats[0]) catId = cats[0].id;
        }
      }catch(e){/* ignore */}

      // å–å€™é¸æ–‡ç« ï¼ˆæœ€å¤š 10 ç¯‡ï¼‰
      let candidates = [];
      if(catId){
        const resp = await fetch(`https://blog.104.com.tw/wp-json/wp/v2/posts?categories=${catId}&per_page=10&orderby=date&order=desc&_embed=1`);
        if(resp.ok) candidates = await resp.json();
      }
      // è‹¥åˆ†é¡ç©ºï¼Œæ”¹é—œéµå­—å¤šæŠ“å¹¾çµ„åˆä½µ
      if(!candidates || !candidates.length){
        const keywords = ['å­¸æ¸¬','ç”³è«‹å…¥å­¸','å¿—é¡˜','é«˜ä¸­','é«˜è·','æŠ€é«˜','å­¸ç¿’æ­·ç¨‹','å‚™å¯©','è¡“ç§‘'];
        for(const k of keywords){
          const resp = await fetch(`https://blog.104.com.tw/wp-json/wp/v2/posts?search=${encodeURIComponent(k)}&per_page=5&orderby=date&order=desc&_embed=1`);
          if(resp.ok){
            const arr = await resp.json();
            candidates = candidates.concat(arr);
          }
        }
      }

      // å»é‡ï¼ˆç”¨ idï¼‰
      const map = new Map();
      candidates.forEach(p=>map.set(p.id, p));
      candidates = Array.from(map.values());

      // æ‰“åˆ†ï¼šæ˜¯å¦å«å½±ç‰‡ï¼ˆYouTube/youtu.be/<video>ï¼‰+ ç™¼å¸ƒæ™‚é–“
      function hasVideo(p){
        const html = (p.content && p.content.rendered) ? p.content.rendered : '';
        return /youtube\.com|youtu\.be|<video/i.test(html);
      }
      candidates.sort((a,b)=>{
        const av = hasVideo(a) ? 1 : 0;
        const bv = hasVideo(b) ? 1 : 0;
        if(bv !== av) return bv - av; // å½±ç‰‡å„ªå…ˆ
        return new Date(b.date) - new Date(a.date); // æ–°åˆ°èˆŠ
      });

      const post = candidates[0];
      if(post){
        const title = (post.title && post.title.rendered) ? post.title.rendered.replace(/<[^>]+>/g,'') : '104 æœ€æ–°å…§å®¹';
        const url = post.link || 'https://blog.104.com.tw/';
        const date = post.date ? new Date(post.date) : null;
        linkEl.textContent = title;
        linkEl.href = url;
        metaEl.textContent = (date ? `ç™¼ä½ˆï¼š${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}` : '') + (hasVideo(post) ? 'ï½œé¡å‹ï¼šå½±ç‰‡/å½±éŸ³' : '');
        if(hasVideo(post)) chipEl.style.display = 'inline-block';
        return;
      }

      // ä»æ²’æœ‰
      linkEl.textContent = 'å‰å¾€ 104ï¼šé«˜ä¸­è·ç›¸é—œæœ€æ–°å…§å®¹';
      linkEl.href = 'https://blog.104.com.tw/category/topic/seniorhigh/';
      metaEl.textContent = 'ï¼ˆæœªèƒ½è‡ªå‹•å–å¾—æ–‡ç« æ¨™é¡Œï¼Œè«‹é»æ“ŠæŸ¥çœ‹ï¼‰';
    }catch(err){
      linkEl.textContent = 'å‰å¾€ 104ï¼šé«˜ä¸­è·ç›¸é—œæœ€æ–°å…§å®¹';
      linkEl.href = 'https://blog.104.com.tw/category/topic/seniorhigh/';
      metaEl.textContent = 'ï¼ˆç„¡æ³•å–å¾—è³‡æ–™ï¼Œè«‹é»æ“ŠæŸ¥çœ‹ï¼‰';
    }
  }

  // ====== Render Events ======
  const cardsEl = document.getElementById('cards');
  events.forEach(evt=>{
    const start = toLocalDate00(evt.date);
    const card = document.createElement('section');
    card.className = 'card';
    card.innerHTML = `
      <div class="title">
        <div>
          <div class="event-name">${evt.name}</div>
          <div class="detail">æ—¥æœŸï¼š${evt.date}ï¼ˆæ•´å¤©ï¼‰</div>
        </div>
        <span class="badge">ID ${evt.id}</span>
      </div>
      <div class="big" id="big-${evt.id}">â€” å¤© â€” æ™‚ â€” åˆ† â€” ç§’</div>
      <div class="detail" id="days-${evt.id}">é‚„æœ‰ â€” å¤©</div>
      <div class="row">
        <a class="btn btn-primary" href="${googleUrl(evt)}" target="_blank" rel="noopener">åŠ åˆ° Google è¡Œäº‹æ›†</a>
        <a class="btn btn-ghost" href="${outlookWebUrl(evt)}" target="_blank" rel="noopener">åŠ åˆ° Outlook è¡Œäº‹æ›†</a>
      </div>
      <div class="meta">
        <span class="dot ${daysLeft(start) <= 7 ? 'warn':'ok'}"></span>
        <span id="meta-${evt.id}">ç‹€æ…‹åµæ¸¬ä¸­â€¦</span>
      </div>`;
    cardsEl.appendChild(card);
  });

  function tick(){
    events.forEach(evt=>{
      const start = toLocalDate00(evt.date);
      const parts = diffPartsTo(start);
      const big = document.getElementById(`big-${evt.id}`);
      const daysEl = document.getElementById(`days-${evt.id}`);
      const metaEl = document.getElementById(`meta-${evt.id}`);
      big.textContent = `${String(parts.days)} å¤© ${String(parts.hours).padStart(2,'0')} æ™‚ ${String(parts.mins).padStart(2,'0')} åˆ† ${String(parts.secs).padStart(2,'0')} ç§’`;
      daysEl.textContent = `é‚„æœ‰ ${daysLeft(start)} å¤©`;
      const left = daysLeft(start);
      metaEl.textContent = left === 0 ? 'ä»Šå¤©å°±æ˜¯æ´»å‹•æ—¥ï¼' :
                           left <= 7 ? 'é€²å…¥æœ€å¾Œä¸€é€±ï¼Œåˆ¥å¿˜äº†æº–å‚™ã€‚' :
                           left <= 30 ? 'ä¸€å€‹æœˆå…§ï¼Œå®‰æ’å¥½è¡Œç¨‹ã€‚' :
                           'æ™‚é–“é‚„å……è£•ï¼Œå…ˆè¨˜åˆ°è¡Œäº‹æ›†ã€‚';
      const dot = metaEl.parentElement.querySelector('.dot');
      dot.className = 'dot ' + (left <= 7 ? 'warn' : 'ok');
    });
  }

  // ====== Boot ======
  renderTopBoard();
  fetch104Content();
  tick();
  setInterval(tick, 1000);
  document.getElementById('tz').textContent = Intl.DateTimeFormat().resolvedOptions().timeZone || 'ï¼ˆåµæ¸¬ä¸åˆ°ï¼‰';
})();
</script>
</body>
</html>
