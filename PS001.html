<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>個人風格檢核</title>
  <style>
    :root { --font-scale: 1; }
    html { font-size: calc(16px * var(--font-scale)); }
    body {
      font-family: "Noto Sans TC", Arial, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #ffe0b2 100%);
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    /* Toolbar */
    .toolbar {
      position: fixed; top: 10px; right: 12px; display: flex; gap: 8px; z-index: 1000;
    }
    .tool-btn {
      width: 40px; height: 40px; border-radius: 999px; border: none; cursor: pointer;
      background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,.08);
      display: inline-flex; align-items: center; justify-content: center;
      font-weight: 800; font-size: 1rem; color: #ff8c00;
      transition: transform .1s ease, box-shadow .2s ease;
    }
    .tool-btn:active { transform: scale(.96); box-shadow: 0 2px 10px rgba(0,0,0,.16); }
    .tool-btn:focus { outline: 3px solid #ffdfb3; }
    .container {
      max-width: 420px; width: 100%; margin: 3.2rem auto 2rem;
      background: #fff; border-radius: 1.5rem; box-shadow: 0 4px 24px rgba(0,0,0,.08);
      padding: 2rem 1.2rem 1.5rem; display: flex; flex-direction: column; gap: 1.2rem;
    }
    .title { font-size: 1.7rem; font-weight: 800; color: #ff9800; text-align: center; margin-bottom: .5rem; }
    .desc { color: #444; font-size: 1rem; text-align: center; margin-bottom: 1rem; line-height: 1.9; }
    .desc--start { font-size: 1.25rem; color: #333; }
    .question { font-size: 1.25rem; font-weight: 700; margin-bottom: .5rem; color: #333; text-align: center; }
    .options { display: flex; flex-wrap: wrap; gap: .7rem; justify-content: center; }
    .option {
      flex: 1 1 40%; min-width: 180px; max-width: 350px; box-sizing: border-box;
      background: #fff3e0; border-radius: .8rem; padding: 1.2rem 1rem; text-align: center;
      display: flex; align-items: center; justify-content: center; gap: .5rem;
      font-size: 1.13rem; cursor: pointer; border: 2px solid transparent;
      transition: border .2s, background .2s, box-shadow .2s, transform .15s, color .2s;
      box-shadow: 0 2px 8px rgba(255,152,0,0.04); color: #3e3e3e; user-select: none;
    }
    .option.selected {
      border: 2px solid #ff9800; background: #ffe0b2; box-shadow: 0 4px 16px rgba(255,152,0,0.13);
      transform: scale(1.04); color: #8a5a00; font-weight: 900; font-size: 1.22rem;
    }
    .option:hover:not(.option-disabled) { border: 2px solid #ffb74d; background: #fff8e1; box-shadow: 0 4px 16px rgba(255,152,0,0.10); transform: scale(1.03); }
    .option.option-disabled { cursor: not-allowed; }
    .actions { display: flex; justify-content: space-between; gap: 1rem; margin-top: 1rem; }
    .btn {
      background: linear-gradient(90deg, #ff9800 60%, #ffb74d 100%);
      color: #fff; border: none; border-radius: 1.2rem; padding: .7rem 1.6rem; font-size: 1.13rem; font-weight: 800;
      cursor: pointer; box-shadow: 0 2px 8px rgba(255,152,0,0.10);
      transition: background .2s, box-shadow .2s, transform .1s ease; min-width: 7.5rem;
    }
    .btn:active { background: #ff9800; box-shadow: 0 2px 8px rgba(255,152,0,0.18); transform: translateY(1px); }
    .btn--ghost { background: #fff; color: #ff9800; border: 2px solid #ffb74d; }
    .progress-bar-wrap { width: 100%; background: #f0f0f0; border-radius: .6rem; height: .7rem; margin: .7rem 0 1.2rem; overflow: hidden; }
    .progress-bar { height: 100%; background: linear-gradient(90deg, #ff9800 60%, #ffb74d 100%); border-radius: .6rem; transition: width .4s; }
    .result { text-align: center; }
    .score-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 1.2rem; margin: 1.2rem 0 .5rem; }
    .score-item {
      background: #fff3e0; border-radius: 1.2rem; padding: .9rem 1.2rem; font-size: 1.13rem; font-weight: 800;
      min-width: 120px; max-width: 260px; box-shadow: 0 2px 8px rgba(100,181,246,0.08);
      display: flex; align-items: center; justify-content: center; gap: .4rem;
    }
    .style-feature-block { max-width: 560px; margin: 2rem auto 1.2rem; padding: 1.2rem 1.5rem; background: #f8fafc; border-radius: 1.2rem; box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
    @media (max-width: 800px) {
      html, body { height: 100svh; width: 100vw; overflow-x: hidden; }
      .container { min-height: 100svh; height: 100svh; width: 100vw; max-width: 100vw; margin: 0 !important; padding: 0 4vw !important; border-radius: 0; box-sizing: border-box; }
      .title { font-size: 6vw; }
      .question { font-size: 4.3vw; padding: 0 6vw; }
      .option { font-size: 4vw; min-width: 120px; padding: .8rem .5rem; margin: 0 2vw; }
      .score-item { font-size: 4vw; padding: .7rem .7rem; }
      .desc { font-size: 2.8vw; padding: 0 7vw; }
      .actions { padding: 0 2vw; }
    }
    @media (min-width: 800px) {
      .container { max-width: 900px; min-height: 600px; min-width: 600px; padding: 2.5rem 2rem; gap: 2rem; box-sizing: border-box; justify-content: center; }
      .title { font-size: 2.1rem; margin-bottom: 1.2rem; }
      .question { font-size: 1.35rem; margin-bottom: 1.2rem; }
      .options { flex-wrap: wrap; gap: 1.2rem 2.5rem; justify-content: flex-start; margin-bottom: 1.5rem; }
      .actions { margin-top: 2.2rem; }
      .desc { font-size: 1.08rem; margin-bottom: .5rem; }
    }
  </style>
</head>
<body>
  <!-- 字級調整工具列 -->
  <div class="toolbar" aria-label="字級調整工具列">
    <button class="tool-btn" id="btnFontDown" title="縮小字級 A-" aria-label="縮小字級">A-</button>
    <button class="tool-btn" id="btnFontUp" title="放大字級 A+" aria-label="放大字級">A+</button>
  </div>

  <div class="container" id="app"></div>

  <script>
  // ====== 題庫與設定 ======
  const questions = [
    ["獨當一面", "綜整研判", "變化多元", "創新獨特", "規劃組織", "井然有序", "同理情感", "接觸人群"],
    ["實事求是", "問題解析", "實驗嘗試", "規劃遠景", "掌控管理", "資料彙整", "支持輔導", "建立關係"],
    ["追根究底", "邏輯思考", "創新研發", "無拘無束", "建立規則", "行政處理", "傾聽他人", "團隊合作"],
    ["績效導向", "數據分析", "發揮想像", "推銷想法", "協調支援", "注重細節", "感性溫馨", "教育諮詢"],
    ["明快決策", "分析推理", "創意設計", "新奇刺激", "執行計畫", "按部就班", "關懷弱勢", "協助他人"]
  ];
  const answerMap = [
    ["R","R","I","I","O","O","F","F"],
    ["R","R","I","I","O","O","F","F"],
    ["R","R","I","I","O","O","F","F"],
    ["R","R","I","I","O","O","F","F"],
    ["R","R","I","I","O","O","F","F"]
  ];
  const styleList = [
    { key:'R', name:'R.理智型風格', color:'#64b5f6', feature:{behavior:'邏輯分析特質強，重視證據、數據，追根究底。', advantage:'邏輯分析、就事論事。', disadvantage:'義正嚴辭、心直口快。'} },
    { key:'I', name:'I.開創型風格', color:'#ff9800', feature:{behavior:'想法鮮活多變，勇於嘗試，強調創新與嘗試。', advantage:'創意思考、勇於嘗試。', disadvantage:'天馬行空、不切實際。'} },
    { key:'O', name:'O.組織型風格', color:'#81c784', feature:{behavior:'事務管理特質強，強調按部就班，謹慎可靠。', advantage:'組織條理、按部就班。', disadvantage:'較少彈性、不愛變通。'} },
    { key:'F', name:'F.情感型風格', color:'#e57373', feature:{behavior:'人際互動特質強，樂於助人，強調團隊和諧。', advantage:'關懷可親、樂於助人。', disadvantage:'感情用事、優柔寡斷。'} },
  ];
  const stepSelectNum = [4,2,1]; // 每題三輪：先從8選4，再從4選2，再從2選1

  // ====== 狀態 ======
  let state = {
    page: 'start', // start | question | result
    qIndex: 0,     // 0~4
    subStep: 0,    // 0~2
    selected: [[], [], [], [], []], // 每題三輪的索引
    score: { R:0, I:0, O:0, F:0 }
  };

  // ====== 字級調整 ======
  (function initFontToolbar(){
    const root = document.documentElement;
    const clamp = (n, a, b) => Math.min(Math.max(n, a), b);
    let scale = 1;
    document.getElementById('btnFontUp').addEventListener('click',()=>{
      scale = clamp(parseFloat((scale + 0.1).toFixed(2)), 0.8, 1.8);
      root.style.setProperty('--font-scale', scale);
    });
    document.getElementById('btnFontDown').addEventListener('click',()=>{
      scale = clamp(parseFloat((scale - 0.1).toFixed(2)), 0.8, 1.8);
      root.style.setProperty('--font-scale', scale);
    });
  })();

  // ====== Render ======
  function render(){
    const app = document.getElementById('app');
    if (state.page === 'start'){
      app.innerHTML = `
        <div class="start-page" style="width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:420px;">
          <div class="title">個人風格心理測驗</div>
          <div class="desc desc--start">
            依每題前的指示，從日常工作與學習經驗中，依序挑選讓您
            <b>來勁忘我、如魚得水、心想事成、欲罷不能</b> 的工作要素。
          </div>
          <div class="actions" style="justify-content:center;">
            <button class="btn" onclick="startTest()">開始測驗</button>
          </div>
        </div>`;
      return;
    }

    
    if (state.page === 'question'){
      const q = questions[state.qIndex];
      const selectNum = stepSelectNum[state.subStep];
      let prevSelected = [];
      if (state.subStep > 0) prevSelected = state.selected[state.qIndex][state.subStep - 1] || [];
      const progress = Math.round(((state.qIndex * 3 + state.subStep + 1) / (questions.length * 3)) * 100);
      app.innerHTML = `
        <div class="progress-bar-wrap"><div class="progress-bar" style="width:${progress}%;"></div></div>
        <div class="title">第 ${state.qIndex + 1} 題</div>
        <div class="desc" style="font-size:1.1rem;color:#333;text-align:center;line-height:1.7;margin-top:-.6rem;">
          ${(() => {
            if (state.subStep === 0) {
              return `請先從以下 <b>8個</b> 選項中，挑選出 <b>4個</b> 讓您覺得
              <span style="color:#ff9800;font-weight:800;">來勁忘我、如魚得水、心想事成、欲罷不能</span> 的工作要素。`;
            } else if (state.subStep === 1) {
              return `請再從以下 <b>4個</b> 選項中，挑選出 <b>2個</b> 讓您覺得更
              <span style="color:#ff9800;font-weight:800;">來勁忘我、如魚得水、心想事成、欲罷不能</span> 的工作要素。`;
            } else {
              return `最後再從以下 <b>2個</b> 選項中，挑選出 <b>1個</b> 讓您覺得最最最
              <span style="color:#ff9800;font-weight:800;">來勁忘我、如魚得水、心想事成、欲罷不能</span> 的工作要素。`;
            }
          })()}
        </div>
        <div class="question">
          ${ state.subStep === 0 ? "請選出 <span style='color:#ff9800;font-weight:800;'>4個</span> 選項：" :
             state.subStep === 1 ? "請選出 <span style='color:#ff9800;font-weight:800;'>2個</span> 選項：" :
                                    "請選出 <span style='color:#ff9800;font-weight:800;'>1個</span> 選項：" }
        </div>
        <div class="options" style="width:100%;max-width:700px;margin:0 auto;">
          ${q.map((text, i) => {
            const selectedArr = state.selected[state.qIndex][state.subStep] || [];
            const checked = selectedArr.includes(i);
            let disabled = false, faded = false;
            if (state.subStep > 0 && !prevSelected.includes(i)) { disabled = true; faded = true; }
            else if (!checked && selectedArr.length >= selectNum) { disabled = true; }
            return `
              <label class="option${checked ? ' selected' : ''}${disabled ? ' option-disabled' : ''}" style="${faded ? 'opacity:.4;pointer-events:none;' : ''}; position:relative;" onclick="${disabled ? '' : `toggleOption(${i})`}">
                <input type="checkbox" ${checked ? 'checked' : ''} ${disabled ? 'disabled' : ''} onchange="toggleOption(${i})" onclick="event.stopPropagation()" style="position:absolute;left:-9999px;width:1px;height:1px;opacity:0;">
                ${text}
              </label>`;
          }).join('')}
        </div>
        <div class="actions">
          <button class="btn btn--ghost" onclick="prevStep()">上一步</button>
          <button class="btn" onclick="nextStep()">下一步</button>
        </div>
        <div class="desc" style="font-size:.98rem;color:#666;">（每題分三輪：依序選 4、2、1 個項目）</div>
      `;
      return;
    }

    // 結果頁（兩段式：上方象限、下方解釋）
    app.innerHTML = `
      <div class="result">
        <div class="title">個人風格檢核結果</div>

        <!-- Top: Quadrant only -->
        <section id="quadrant" style="position:relative;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;
             gap:3rem;padding:2rem 1rem;justify-items:center;align-items:center;width:100%;max-width:540px;margin:1rem auto 3rem;">
          <div style="position:absolute;top:50%;left:0;width:100%;height:2px;background:#ddd;transform:translateY(-1px);z-index:0;"></div>
          <div style="position:absolute;left:50%;top:0;width:2px;height:100%;background:#ddd;transform:translateX(-1px);z-index:0;"></div>

          <div class="score-item" style="grid-area:1/1/2/2;color:#64b5f6;background:#e3f2fd;z-index:1;">理智：<span>${state.score.R}</span></div>
          <div class="score-item" style="grid-area:1/2/2/3;color:#ff9800;background:#fff8e1;z-index:1;">開創：<span>${state.score.I}</span></div>
          <div class="score-item" style="grid-area:2/1/3/2;color:#81c784;background:#e8f5e9;z-index:1;">組織：<span>${state.score.O}</span></div>
          <div class="score-item" style="grid-area:2/2/3/3;color:#e57373;background:#fdecea;z-index:1;">情感：<span>${state.score.F}</span></div>
        </section>

        <!-- Bottom: Explanation only -->
        <section id="explain" style="max-width:640px;margin:0 auto 2rem;">
          <div style="text-align:center;font-weight:800;color:#333;font-size:1.3rem;margin-bottom:.8rem;">結果解釋</div>
          <div class="style-feature-block">${getFeatureDesc()}</div>
        </section>

        <div class="actions" style="justify-content:center;gap:1rem;margin-bottom:2rem;">
          <button class="btn btn--ghost" onclick="restart()">重新測驗</button>
          <button class="btn" onclick="shareResultUrl()">分享結果</button>
        </div>
      </div>
    `;
  }

  // ====== 互動邏輯 ======
  function startTest(){
    state = { page:'question', qIndex:0, subStep:0, selected:[[],[],[],[],[]], score:{R:0,I:0,O:0,F:0} };
    render();
  }

  function toggleOption(idx){
    const arr = state.selected[state.qIndex][state.subStep] || [];
    const selectNum = stepSelectNum[state.subStep];
    if (state.subStep > 0) {
      const prevArr = state.selected[state.qIndex][state.subStep - 1] || [];
      if (!prevArr.includes(idx)) return;
    }
    if (arr.includes(idx)) {
      state.selected[state.qIndex][state.subStep] = arr.filter(i => i !== idx);
    } else {
      if (arr.length < selectNum) state.selected[state.qIndex][state.subStep] = [...arr, idx];
    }
    render();
  }

  function calcQuestionScore(qIdx){
    const points = [1,2,2];
    const selected3 = state.selected[qIdx] || [];
    let local = {R:0,I:0,O:0,F:0};
    for (let s=0; s<3; s++){
      const arr = selected3[s] || [];
      arr.forEach(i => { const k = answerMap[qIdx][i]; local[k] += points[s]; });
    }
    return local;
  }

  function applyScoreDelta(delta, minus=false){
    for (const k of ['R','I','O','F']){
      state.score[k] += minus ? -delta[k] : delta[k];
      if (state.score[k] < 0) state.score[k] = 0;
    }
  }

  function nextStep(){
    const selectNum = stepSelectNum[state.subStep];
    const selectedItems = state.selected[state.qIndex][state.subStep] || [];
    if (selectedItems.length !== selectNum) { alert(`請選擇 ${selectNum} 個項目`); return; }

    if (state.subStep < 2){
      state.subStep++; render(); return;
    }
    // 第三輪結束 → 計分並進下一題
    const delta = calcQuestionScore(state.qIndex);
    applyScoreDelta(delta, false);
    state.qIndex++; state.subStep = 0;
    if (state.qIndex === questions.length) state.page = 'result';
    render();
  }

  function prevStep(){
    if (state.page === 'result'){
      // 從結果頁回上一步：回到最後一題第3輪，並回滾最後一題分數
      state.page = 'question'; state.qIndex = questions.length - 1; state.subStep = 2;
      const delta = calcQuestionScore(state.qIndex); applyScoreDelta(delta, true);
      render(); return;
    }
    if (state.subStep > 0){ state.subStep--; render(); return; }
    if (state.subStep === 0 && state.qIndex > 0){
      // 回到上一題第3輪並回滾上一題分數
      const prevQ = state.qIndex - 1;
      const delta = calcQuestionScore(prevQ); applyScoreDelta(delta, true);
      state.qIndex = prevQ; state.subStep = 2; render(); return;
    }
    if (state.subStep === 0 && state.qIndex === 0){ restart(); }
  }

  function restart(){
    if (history && history.replaceState) history.replaceState({}, document.title, location.origin + location.pathname);
    state = { page:'start', qIndex:0, subStep:0, selected:[[],[],[],[],[]], score:{R:0,I:0,O:0,F:0} };
    render();
  }

  function getFeatureDesc(){
    // 支援同分並列：找出所有最高分向度並全部呈現
    const maxScore = Math.max(state.score.R, state.score.I, state.score.O, state.score.F);
    const topKeys = ['R','I','O','F'].filter(k => state.score[k] === maxScore);
    const blocks = topKeys.map(k => {
      const s = styleList.find(x => x.key === k);
      return `
        <div style="color:${s.color}; margin-bottom:1rem;">
          <div style="font-weight:800;font-size:1.18rem;margin-bottom:.7rem;">${s.name}</div>
          <div style="margin-bottom:.4rem;"><span style="font-weight:800;">行為展現：</span>${s.feature.behavior}</div>
          <div style="margin-bottom:.4rem;"><span style="font-weight:800;">優勢特質：</span>${s.feature.advantage}</div>
          <div><span style="font-weight:800;">可能缺點：</span>${s.feature.disadvantage}</div>
        </div>`;
    });
    return blocks.join('<hr style="border:none;height:1px;background:#eee;margin:.6rem 0;" />');
  }

  function getQueryScores(){
    const p = new URLSearchParams(location.search);
    const R = parseInt(p.get('R')), I = parseInt(p.get('I')), O = parseInt(p.get('O')), F = parseInt(p.get('F'));
    return { R:isNaN(R)?0:R, I:isNaN(I)?0:I, O:isNaN(O)?0:O, F:isNaN(F)?0:F };
  }

  function shareResultUrl(){
    const {R,I,O,F} = state.score;
    const url = `${location.origin}${location.pathname}?R=${R}&I=${I}&O=${O}&F=${F}`;
    navigator.clipboard.writeText(url);
    alert('已複製分享連結！');
  }

  // 初始 render（若網址帶分數就直接進結果頁）
  window.addEventListener('DOMContentLoaded', () => {
    const qs = getQueryScores();
    if (qs.R || qs.I || qs.O || qs.F) {
      state.page = 'result'; state.score = qs; render();
    } else { render(); }
  });
  </script>
</body>
</html>
